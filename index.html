<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">
    <!-- 兼容IOS9 -->
    <title>北理镜像站</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"></head>
    <style>
      .mir-shadow{ box-shadow: 10px 10px 15px #8e8e8e; } 
      #gotoTop{ position: fixed; bottom: 10px; right: 10px; width: 50px; height: 50px; opacity: 0.5; } 
      #gotoTop:hover{ opacity: 1; }
    </style>
  <body>
    <header>
      <div class="collapse bg-dark" id="headerNav">
        <div class="container">
          <div class="row">
            <div class="col-sm-8 col-md-7 py-4">
              <h4 class="text-white">About</h4>
              <p class="text-muted">北理镜像站是由北京理工大学网络开拓者协会负责运营的开源镜像站</p></div>
            <div class="col-sm-4 offset-md-1 py-4">
              <h4 class="text-white">Contact</h4>
              <ul class="list-unstyled">
                <li>
                  <a href="#" class="text-white">北京理工大学官网</a></li>
                <li>
                  <a href="#" class="text-white">网络开拓者协会(BITNP)主页</a></li>
                <li>
                  <a href="#" class="text-white">加入我们</a></li>
                <li>
                  <a href="#" class="text-white">联系我们</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="navbar navbar-dark bg-dark box-shadow">
        <div class="container d-flex justify-content-between">
          <a href="#" class="navbar-brand d-flex align-items-center">
            <strong>北理镜像站</strong></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#headerNav" aria-controls="navbarHeader" aria-expended="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </div>
    </header>
    <main>
      <section class="jumbotron text-center">
        <div class="container">
          <h1 class="jumbotron-heading">北京理工大学开源软件镜像站</h1>
          <p>网络开拓者协会（Net Pioneer Association of BIT，以下简称网协），成立于1997年，是北京理工大学校内规模最大的社团之一，本着“网络无限，开拓不懈”的精神，不断摸索、引领校园网络建设，后成为校团委领导的全校唯一IT类学生组织。经过20年的不断成长，各项规章制度和硬件设备基本完善，成长为北理最大的网络服务提供团体，拥有每日最高的访问量，从学校学生工作，到日常娱乐服务，协会的服务范围仍然在继续的扩大。同时，协会自身也在不断努力的增强实力，拓展业务。</p>
          <p>
            <a href="downloads.html" class="btn btn-primary">进入下载页</a>
            <a href="help.html" class="btn btn-secondary">帮助</a></p>
        </div>
      </section>
      <div class="py-5 bg-light">
        <div class="container" id="main_container">
          <div class="row"></div>
        </div>
      </div>
    </main>
    <footer class="text-muted">
      <div class="container">
        <p class="float-right">
          <a href="#">回到顶部</a></p>
        <p>Copyright © 1997-2018 Net Pioneer Association of BIT All Rights Reserved. Designed by Maidong</p>
      </div>
    </footer>
    <a id="gotoTop" href="#">
      <img src="img/gotoTop.png" width="50" height="50" alt="" /></a>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="js/socket.io-2.0.3.js"></script>
    <script src="js/functions.js"></script>
    <script>
      var requests = GetRequest();

      var socket = io('http://localhost:3000');

      socket.emit('data', {
        "type": "mirrors"
      });
      socket.on('data',
      function(data) {
        data = dataFilter(data);
        window.data = data; // 将数据放到全局环境中保存起来，以便瀑布流模式加载
        loadHTML(data.datas);
      });

      // 加载数据
      // 默认加载9项
      // model
      // 		0：全加载
      // 		1：瀑布流模式，num设置加载数，默认为9项, 从start处开始加载
      function loadHTML(data, model = 1, num = 9, start = 0) {
        // var html = '';
        var main_container = document.getElementById('main_container');
        if (model == 1) {
          var row = main_container.getElementsByClassName('row')[0];
          if (!row) {
            var div_row = document.createElement('div');
            div_row.className = "row";
            document.getElementById('main_container').appendChild(div_row);
            // document.getElementById('main_container').innerHTML = '<div class="row"></div>';
            row = main_container.getElementsByClassName('row')[0];
          }
          for (var mir = start; mir < start + num && mir < data.length; mir++) {
            var Name = data[mir].name;
            var Img = Name + '.png';
            //// debug model
            Img = "deepin.png";
            //// debug model
            // 备用方案1
            // var div = '<div class="col-md-4" id="item_' + mir + '"><div class="card mb-4 mt-4 box-shadow mir-shadow"><img class="card-img-top" src="img/' + Img + '" alt="Card image cap"><div class="card-body"><p class="card-text">' + Name + '</p><div class="d-flex justify-content-between align-items-center"><div class="btn-group"><button type="button" class="btn btn-sm btn-outline-secondary" name="' + Name + '">下载</button><button type="button" class="btn btn-sm btn-outline-secondary">反馈</button></div></div></div></div></div>';
      			var div = document.createElement('div');
      			div.className = "col-md-4";
      			div.id = 'item_' + mir;
      			var div1 = document.createElement('div');
      			div1.className = "card mb-4 mt-4 box-shadow mir-shadow";
      			div.appendChild(div1);
      			var image = document.createElement('img');
      			image.className = "card-img-top";
      			image.src = "img/" + Imgs;
      			image.alt = "Card image cap";
      			div1.appendChild(image);
      			var div2 = document.createElement('div');
      			div2.className = 'card-body';
      			div1.appendChild(div2);
      			var p = document.createElement('p');
      			p.className = "card-text";
      			p.innerText = Name;
      			div2.appendChild(p);
      			var div3 = document.createElement('div');
      			div3.className = "d-flex justify-content-between align-items-center";
      			div2.appendChild(div3);
      			var div4 = document.createElement('div');
      			div4.className = "btn-group";
      			div3.appendChild(div4);
      			var btn1 = document.createElement('button');
      			btn1.className = 'btn btn-sm btn-outline-secondary';
      			btn1.type = 'button';
      			btn1.name = Name;
      			btn1.innerText = "下载";
      			div4.appendChild(btn1);
      			var btn2 = document.createElement('button');
      			btn2.className = 'btn btn-sm btn-outline-secondary';
      			btn2.type = 'button';
      			btn2.innerText = "反馈";
      			div4.appendChild(btn2)

      			row.appendChild(div);
            // html += div;
          }

          // $(row).append(html);
        }

        addCilckActions();
      }
      // 绑定鼠标单击事件
      function addCilckActions() {
        $(".btn-outline-secondary[name]").click(function() {
          var name = $(this).attr("name");

          var href = window.location.pathname;
          var hrefArr = href.split('/');
          href = href.substring(0, href.length - hrefArr[hrefArr.length - 1].length);
          href += 'mirrors/details.html?name=' + name;
          window.location.href = href;
        });
      }

      // 瀑布流模式加载数据
      window.onscroll = function() {
        if (checkLoad()) {
          var nodeNum = $("#main_container .row").children().length;
          loadHTML(data.datas, 1, 9, nodeNum);
        }
      }

      // 瀑布流模式, 检查是否应该加载
      function checkLoad() {
        var contentHeight = $(".col-md-4:last").offset().top;
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        var pageHeight = document.documentElement.clientHeight || document.body.clientHeight;
        if (contentHeight < scrollTop + pageHeight) {
          return true;
        }
      };</script>
  </body>

</html>